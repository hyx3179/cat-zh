const swRevision=1,GHCDN="https://cdn.jsdelivr.net/gh/hyx3179",BACKUP="https://cat-zh-hyx3179.netlify.app",cacheStorage="cat-"+swRevision,HOSTNAME_BLACKLIST=["hm.baidu.com","p.qlogo.cn","q2.qlogo.cn","kittensgame.com","www.google-analytics.com"],NO_CACHE_LIST=["/cat-zh/server.json","/cat-zh/build.version.json","/scientists/ks.version.json"],KS_LIST=["/scientists/kitten-scientists.user.js","/scientists/ks.version.json"],getRequest=a=>{var c=[a];a=new URL(a.url);if(a.hostname!==self.location.hostname)c=
[new Request(a.href,{mode:"cors"})];else{if(GHCDN){var b=a.pathname.indexOf("/",1),d=a.pathname.slice(0,b);b=a.pathname.slice(b);"/"!==b&&(-1<b.indexOf(".css")&&(b=b.slice(0,-4)+".min.css"),d=new Request(GHCDN+d+"@gh-pages"+b+a.search,{mode:"cors"}),c.push(d))}BACKUP&&(a=new Request(BACKUP+a.pathname+a.search,{mode:"cors"}),c.push(a))}return c},getFetch=a=>{var c=[];for(let b in a)c.push(fetch(a[b],{cache:"no-store"}));return c};
self.addEventListener("install",a=>{a.waitUntil(caches.open(cacheStorage).then(c=>c.add("/cat-zh/")))});self.addEventListener("activate",a=>{a.waitUntil(Promise.all([self.clients.claim(),caches.keys().then(c=>Promise.all(c.filter(b=>{b=b.split("-");return 2==b.length&&"cat"===b[0]&&b[1]!==swRevision.toString()}).map(b=>caches.delete(b))))]))});
self.addEventListener("fetch",a=>{if(-1==HOSTNAME_BLACKLIST.indexOf((new URL(a.request.url)).hostname)){var c=-1<KS_LIST.indexOf((new URL(a.request.url)).pathname)?"scientists":cacheStorage;const b=getRequest(a.request);-1<NO_CACHE_LIST.indexOf((new URL(a.request.url)).pathname)?a.respondWith(Promise.race(getFetch(b)).then(d=>{const e=d.clone();Promise.all([e,caches.open(c)]).then(([g,f])=>{f.delete(b[0],{ignoreSearch:!0});f.put(b[0],g)});return d}).catch(d=>caches.match(b[0],{ignoreSearch:!0}).then(e=>
e))):a.respondWith(caches.match(b[0]).then(d=>void 0!==d?d:Promise.race(getFetch(b)).then(e=>{const g=e.clone();Promise.all([g,caches.open(c)]).then(([f,h])=>h.put(b[0],f));return e})))}});
