const swRevision=2,GHCDN="https://cdn.jsdelivr.net/gh/hyx3179",BACKUP="https://cat-zh-hyx3179.netlify.app",cacheStorage="cat-"+swRevision,HOSTNAME_BLACKLIST=["hm.baidu.com","p.qlogo.cn","q2.qlogo.cn","kittensgame.com","www.google-analytics.com"],NO_CACHE_LIST=["/cat-zh/server.json","/cat-zh/build.version.json","/scientists/ks.version.json"],getRequest=a=>{a=new URL(a);if(a.hostname!==location.hostname)var c=[new Request(a.href,{mode:"cors"})];else{c="/"+a.pathname.split("/").filter(e=>0<e.length).join("/");
-1==c.indexOf("/",1)&&(c+="/");a=new URL(a.origin+c+a.search);c=[new Request(a,{mode:"no-cors"})];if(GHCDN){var b=a.pathname.indexOf("/",1),d=a.pathname.slice(0,b);b=a.pathname.slice(b);"/"!==b&&(-1<b.indexOf(".css")&&(b=b.slice(0,-4)+".min.css"),d=new Request(GHCDN+d+"@gh-pages"+b+a.search,{mode:"cors"}),c.push(d))}BACKUP&&(a=new Request(BACKUP+a.pathname+a.search,{mode:"cors"}),c.push(a))}return c},getFetch=a=>{let c=[];for(let b in a)c.push(fetch(a[b],{cache:"no-store"}));return c};
addEventListener("install",a=>{a.waitUntil(caches.open(cacheStorage).then(c=>c.add("/cat-zh/")))});addEventListener("activate",a=>{a.waitUntil(Promise.all([clients.claim(),caches.keys().then(c=>Promise.all(c.filter(b=>{b=b.split("-");return 2==b.length&&"cat"===b[0]&&b[1]!==swRevision.toString()}).map(b=>caches.delete(b))))]))});
addEventListener("fetch",a=>{const c=new URL(a.request.url);if(-1==HOSTNAME_BLACKLIST.indexOf(c.hostname)){let b=cacheStorage;c.hostname!==location.hostname&&(b="catStaticRes");const d=getRequest(c.href);-1<NO_CACHE_LIST.indexOf((new URL(d[0].url)).pathname)?a.respondWith(Promise.race(getFetch(d)).then(e=>{const f=e.clone();Promise.all([f,caches.open(b)]).then(([h,g])=>{g.delete(d[0],{ignoreSearch:!0});g.put(d[0],h)});return e}).catch(e=>caches.match(d[0],{ignoreSearch:!0}).then(f=>f))):a.respondWith(caches.match(d[0]).then(e=>
void 0!==e?e:Promise.race(getFetch(d)).then(f=>{const h=f.clone();Promise.all([h,caches.open(b)]).then(([g,k])=>{k.delete(d[0],{ignoreSearch:!0});k.put(d[0],g)});return f})))}});
