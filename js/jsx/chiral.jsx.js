dojo.declare("classes.Bash",null,{constructor:function(a){this.commands=a;this.prevCommands=[];this.prevCommandsIndex=0},execute:function(a){this.prevCommands.push(a);this.prevCommandsIndex=this.prevCommands.length},autocomplete:function(a){a=a.split(/ +/);var c=a.pop(),b=function(d){return 0==d.indexOf(c)};if(0===a.length)return b=Object.keys(this.commands).filter(b),1===b.length?a.concat(b[0]).join(" "):null},getPrevCommand:function(){return this.prevCommands[--this.prevCommandsIndex]},getNextCommand:function(){return this.prevCommands[++this.prevCommandsIndex]},
hasPrevCommand:function(){return 0!==this.prevCommandsIndex},hasNextCommand:function(){return this.prevCommandsIndex!==this.prevCommands.length-1}});
WTerminal=React.createClass({bash:null,componentWillMount:function(){this.bash=new classes.Bash({help:{exec:function(){}},work:{},build:{},sell:{}})},getInitialState:function(){return{command:null}},setCommand:function(a){a.stopPropagation();a.nativeEvent.stopImmediatePropagation();this.setState({command:a.target.value})},attemptAutocomplete:function(){var a=this.bash.autocomplete(this.state.command||"");this.setState({command:a})},handleKeyDown:function(a){9===a.which?(this.attemptAutocomplete(),
a.preventDefault()):13===a.which&&(this.doSubmit(),a.preventDefault())},handleKeyUp:function(a){},render:function(){return $r("div",null,[$r("input",{type:"text",ref:"input",autoComplete:"off",onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onChange:this.setCommand,value:this.state.command,placeholder:"\u8f93\u5165 'help' \u53ef\u4ee5\u67e5\u8be2\u6240\u6709\u7684\u547d\u4ee4",style:{width:"500px"}}),$r("a",{className:"link",onClick:this.doSubmit},"\u53d1\u9001")])},doSubmit:function(){this.props.onSubmit(this.state.command)}});
WChiral=React.createClass({getInitialState:function(){return{game:this.props.game}},componentDidMount:function(){var a=this;this.updateHandler=dojo.subscribe("ui/update",function(c){a.setState({game:c})})},componentWillUmount:function(){dojo.unsubscribe(this.updateHandler)},setCommand:function(a){a.stopPropagation();a.nativeEvent.stopImmediatePropagation();this.setState({command:a.target.value})},sendCommand:function(a){this.state.game.server.sendCommand(a)},render:function(){var a=this.state.game;
return a.space.getPlanet("furthestRing").reached?a.server.userProfile?$r("div",null,[$r("div",{className:"row"},"\u4e00\u4e2a\u5916\u661f\u673a\u5668\u8eba\u5728\u5b87\u5b99\u8fb9\u754c\u3002"),$r("div",{className:"row"},"666 \u4e2a\u5728\u7ebf\u673a\u5668\u4eba"),$r("div",{className:"row"},[$r("pre",{style:{whiteSpace:"pre-wrap"}},a.server.chiral||">")]),$r("div",{className:"row"},[$r(WTerminal,{onSubmit:this.sendCommand})])]):$r("div",null,"\u8fb9\u754c\u73af\u662f\u865a\u65e0\u800c\u5b89\u9759\u7684"):
null}});
