dojo.declare("com.nuclearunicorn.i18n.Lang",null,{fallbackLocale:"en",availableLocales:null,availableLocaleLabels:null,language:null,messages:null,_deffered:null,platformLocale:null,constructor:function(){var b=new classes.KGConfig;this.availableLocales=[this.fallbackLocale];for(var a in b.statics.locales)this.availableLocales.push(b.statics.locales[a]);this.availableLocaleLabels={en:"English",br:"Portugu\u00eas",cz:"\u010ce\u0161tina",de:"Deutsch",es:"Espa\u00f1ol",fr:"Fran\u00e7ais",fro:"Ancien Fran\u00e7ais",
it:"Italiano",ja:"\u65e5\u672c\u8a9e",ko:"\ud55c\uad6d\uc5b4",nl:"NL",no:"NO",pl:"Polski",ro:"RO",ru:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",tr:"TR",uk:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430",be:"\u0411\u0435\u043b\u0430\u0440\u0443\u0441\u043a\u0430\u044f",zh:"\u4e2d\u6587",zht:"\u6f22\u8a9e"}},init:function(b){var a=this;if(void 0!==navigator.globalization){var c=$.Deferred();navigator.globalization.getPreferredLanguage(function(d){a.platformLocale=d.value;c.resolve()},
function(d){console.error("Unable to get platform locale",d);c.resolve()});return c.promise().then(function(){return a._init(b)})}return this._init(b)},_init:function(b){if(this._deffered)return this._deffered.promise();var a=LCstorage["com.nuclearunicorn.kittengame.language"];this.fallbackLocale="en";if(!a||!this.isAvailable(a)){var c=(this.platformLocale||navigator.language||navigator.userLanguage).split(/[-_]/);a=this.fallbackLocale;for(var d=0;d<this.availableLocales.length;d++)if(this.availableLocales[d]==
c[0].toLowerCase()){a=this.availableLocales[d];break}console.log("Using preferred OS locale:",a);LCstorage["com.nuclearunicorn.kittengame.language"]=a}"en"!==a&&"zh"!==a&&"zht"!==a&&(a="zh");this.language=a;var e=this;this._deferred=$.Deferred();console.log("User selected locale:","'"+a+"'","fallback locale","'"+this.fallbackLocale+"'");console.log("loading fallback messages");$.getJSON("res/i18n/"+this.fallbackLocale+".json?_="+b).done(function(g){e.messages=g;e.language!=e.fallbackLocale?(console.log("trying to load legacy locale system"),
$.getJSON("res/i18n/"+a+".json?_="+b).then(function(f){console.log("loaded legacy locale for lang",a,f);$.extend(e.messages,f)}).fail(function(){console.warn("no legacy locale ","'"+a+"'"," found, skipping...")}).always(function(){console.log("trying to load crowdin locale system");$.getJSON("res/i18n/crowdin/"+a+".json?_="+b).then(function(f){console.log("loaded crowdin locale for lang",a,f);$.extend(e.messages,f);e._deferred.resolve()}).fail(function(){console.warn("no crowdin locale ","'"+a+"'",
" found, skipping...");e._deferred.resolve()})})):e._deferred.resolve()}).fail(function(g){console.error("Unable to load locale chain for  '"+a+"', error:",g)});return this._deferred.promise()},getAvailableLocales:function(){return this.availableLocales},getAvailableLocaleLabels:function(){return this.availableLocaleLabels},getLanguage:function(){return this.language},updateLanguage:function(b){this.language=b;LCstorage["com.nuclearunicorn.kittengame.language"]=b},isAvailable:function(b){for(var a=
0;a<this.availableLocales.length;a++)if(this.availableLocales[a]==b)return!0;return!1},msg:function(b,a){var c=this.messages[b];if(!c)return console.error("Key '"+b+"' wasn't found"),"$"+b;if(a)for(b=0;b<a.length;b++)c=c.replace("{"+b+"}",a[b]);return c}});i18nLang=new com.nuclearunicorn.i18n.Lang;$I=function(b,a){return i18nLang.msg(b,a)};
