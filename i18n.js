dojo.declare("com.nuclearunicorn.i18n.Lang",null,{fallbackLocale:"en",availableLocales:null,availableLocaleLabels:null,language:null,messages:null,_deffered:null,platformLocale:null,constructor:function(){var b=new classes.KGConfig;this.availableLocales=[this.fallbackLocale];console.log("Available locales:",b.statics.locales);for(var a in b.statics.locales)this.availableLocales.push(b.statics.locales[a]);this.availableLocaleLabels={en:"English",br:"Portugu\u00eas",cz:"\u010ce\u0161tina",de:"Deutsch",
es:"Espa\u00f1ol",fr:"Fran\u00e7ais",fro:"Ancien Fran\u00e7ais",it:"Italiano",ja:"\u65e5\u672c\u8a9e",ko:"\ud55c\uad6d\uc5b4",nl:"NL",no:"NO",pl:"Polski",ro:"RO",ru:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",tr:"TR",uk:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430",zh:"\u4e2d\u6587",zht:"\u6f22\u8a9e"}},init:function(b){var a=this;if(void 0!==navigator.globalization){var d=$.Deferred();navigator.globalization.getPreferredLanguage(function(e){a.platformLocale=e.value;d.resolve()},
function(e){console.error("Unable to get platform locale",e);d.resolve()});return d.promise().then(function(){return a._init(b)})}return this._init(b)},_init:function(b){if(this._deffered)return this._deffered.promise();var a=LCstorage["com.nuclearunicorn.kittengame.language"];if(!a||!this.isAvailable(a)){var d=(this.platformLocale||navigator.language||navigator.userLanguage).split(/[-_]/);a=this.fallbackLocale;for(var e=0;e<this.availableLocales.length;e++)if(this.availableLocales[e]==d[0].toLowerCase()){a=
this.availableLocales[e];break}LCstorage["com.nuclearunicorn.kittengame.language"]=a}this.language=a;var c=this;this._deferred=$.Deferred();$.getJSON("res/i18n/"+this.fallbackLocale+".json?_="+b).done(function(g){c.messages=g;"zh"==a?$.getJSON("res/i18n/crowdin/"+a+".json?_="+b).then(function(f){console.log("loaded crowdin locale for lang",a,f);$.extend(c.messages,f);c._deferred.resolve()}).fail(function(){console.log("legacyLocale:","zh");c.messages="zh";c._deferred.resolve()}):c.language!=c.fallbackLocale?
$.getJSON("res/i18n/"+a+".json?_="+b).then(function(f){console.log("loaded legacy locale for lang",a,f);$.extend(c.messages,f);$.getJSON("res/i18n/crowdin/"+a+".json?_="+b).then(function(h){console.log("loaded crowdin locale for lang",a,h);$.extend(c.messages,h);c._deferred.resolve()}).fail(function(){console.log("legacyLocale:",f);c.messages=f;c._deferred.resolve()})}):c._deferred.resolve()}).fail(function(g){console.error("Unable to load locale chain for  '"+a+"', error:",g)});return this._deferred.promise()},
getAvailableLocales:function(){return this.availableLocales},getAvailableLocaleLabels:function(){return this.availableLocaleLabels},getLanguage:function(){return this.language},updateLanguage:function(b){this.language=b;LCstorage["com.nuclearunicorn.kittengame.language"]=b},isAvailable:function(b){for(var a=0;a<this.availableLocales.length;a++)if(this.availableLocales[a]==b)return!0;return!1},msg:function(b,a){var d=this.messages[b];if(!d)return console.error("Key '"+b+"' wasn't found"),"$"+b;if(a)for(b=
0;b<a.length;b++)d=d.replace("{"+b+"}",a[b]);return d}});i18nLang=new com.nuclearunicorn.i18n.Lang;$I=function(b,a){return i18nLang.msg(b,a)};
